---
import MainLayout from "@layouts/MainLayout.astro";

const url = new URL(Astro.request.url);
console.log("Parsed URL:", url);

const searchQuery = url.searchParams.get("q") || "";
console.log("Search Query:", searchQuery);
console.log("Search Params:", url.searchParams.get("q"));

let allData = [];
try {
  allData = await fetch(
    "https://furniture-katalog.vercel.app/search.json"
  ).then((res) => res.json());
} catch (error) {
  console.error("Failed to fetch data:", error);
}
// console.log("API Data:", allData);

const searchResults = searchQuery
  ? allData.filter((item: any) =>
      item.title.toLowerCase().includes(searchQuery.toLowerCase())
    )
  : [];
console.log("Filtered Results:", searchResults);

const pageTitle = `Search Results for "${searchQuery}"`;
console.log("Full URL:", Astro.request.url);
---

<MainLayout pageTitle="Search">
  <h1 class="text-2xl font-semibold text-slate-700">
    {pageTitle || "Search Results"}
  </h1>
  <ul class="mt-8 space-y-4">
    {
      searchQuery ? (
        searchResults.length > 0 ? (
          // Display search results
          searchResults.map((result: any) => (
            <li class="p-4 bg-white border border-gray-200 rounded-lg shadow">
              <a
                href={`/collections/${result.slug || "#"}`}
                class="text-lg font-bold text-slate-800 hover:underline"
              >
                {result.title || "Untitled"}
              </a>
              <p class="text-sm text-slate-600">
                {result.deskripsi || "No description available"}
              </p>
            </li>
          ))
        ) : (
          <div class="text-slate-600">
            No results found for "{searchQuery}".
          </div>
        )
      ) : (
        <div class="text-slate-600">Please enter a search term.</div>
      )
    }

    <!-- {
      searchResults.length > 0 ? (
        searchResults.map((result: any) => (
          <li class="p-4 bg-white border border-gray-200 rounded-lg shadow">
            <a
              href={`/collections/${result.slug}`}
              class="text-lg font-bold text-slate-800 hover:underline"
            >
              {result.title}
            </a>
            <p class="text-sm text-slate-600">{result.deskripsi}</p>
          </li>
        ))
      ) : (
        <div class="text-slate-600">No results found.</div>
      )
    } -->
  </ul>
</MainLayout>
